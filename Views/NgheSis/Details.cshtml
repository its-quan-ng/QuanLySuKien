@model QuanLySuKien.Models.NgheSi

@{
    ViewData["Title"] = Model.TenNgheSi;
}

<div class="artist-detail-page">
    <div class="container">
        <!-- Artist Hero -->
        <div class="artist-hero">
            <div class="artist-hero-image">
                @if (!string.IsNullOrEmpty(Model.AnhDaiDien))
                {
                    @if (Model.AnhDaiDien.StartsWith("http") || Model.AnhDaiDien.StartsWith("/"))
                    {
                        <img src="@Model.AnhDaiDien" alt="@Model.TenNgheSi" onerror="this.onerror=null; this.style.display='none'; this.parentElement.innerHTML='<div class=\'artist-hero-placeholder\'><i class=\'bi bi-person-circle\'></i></div>';">
                    }
                    else
                    {
                        <img src="~/@Model.AnhDaiDien" alt="@Model.TenNgheSi" onerror="this.onerror=null; this.style.display='none'; this.parentElement.innerHTML='<div class=\'artist-hero-placeholder\'><i class=\'bi bi-person-circle\'></i></div>';">
                    }
                }
                else
                {
                    <div class="artist-hero-placeholder">
                        <i class="bi bi-person-circle"></i>
                    </div>
                }
            </div>
            <div class="artist-hero-content">
                <h1 class="artist-name">@Model.TenNgheSi</h1>
                @if (!string.IsNullOrEmpty(Model.TheLoai))
                {
                    <div class="artist-genres">
                        @foreach (var genre in Model.TheLoai.Split('/'))
                        {
                            <span class="genre-tag">@genre.Trim()</span>
                        }
                    </div>
                }
                <button class="btn-follow-large" onclick="followArtist(@Model.Id, '@Model.TenNgheSi')">
                    <i class="bi bi-plus-circle"></i>
                    Theo Dõi Nghệ Sĩ
                </button>
            </div>
        </div>

        <!-- Artist Bio -->
        @if (!string.IsNullOrEmpty(Model.TieuSu))
        {
            <div class="artist-bio-section">
                <h2 class="section-title">Tiểu Sử</h2>
                <div class="artist-bio-content">
                    <p>@Model.TieuSu</p>
                </div>
            </div>
        }

        <!-- Artist Events -->
        <div class="artist-events-section">
            <h2 class="section-title">Sự Kiện Sắp Diễn Ra</h2>
            @if (Model.SuKiens != null && Model.SuKiens.Any(s => s.TrangThai == "SapDienRa"))
            {
                <div class="artist-events-grid">
                    @foreach (var suKien in Model.SuKiens.Where(s => s.TrangThai == "SapDienRa").OrderBy(s => s.NgayToChuc))
                    {
                        <div class="event-card">
                            <a asp-controller="SuKiens" asp-action="Details" asp-route-id="@suKien.Id" class="event-card-overlay"></a>
                            <div class="event-card-image">
                                @if (!string.IsNullOrEmpty(suKien.AnhBia))
                                {
                                    <img src="@suKien.AnhBia" alt="@suKien.TenSuKien">
                                }
                                else
                                {
                                    <div class="event-placeholder-image">
                                        <i class="bi bi-calendar-event"></i>
                                    </div>
                                }
                                <div class="event-date-badge">
                                    <div class="date-month">@suKien.NgayToChuc.ToString("MMM").ToUpper()</div>
                                    <div class="date-day">@suKien.NgayToChuc.Day</div>
                                </div>
                                @if (!string.IsNullOrEmpty(suKien.LoaiSuKien))
                                {
                                    <div class="event-category-badge">@suKien.LoaiSuKien</div>
                                }
                            </div>
                            <div class="event-card-content">
                                <h3 class="event-card-title">
                                    <a asp-controller="SuKiens" asp-action="Details" asp-route-id="@suKien.Id">@suKien.TenSuKien</a>
                                </h3>
                                <div class="event-card-venue">
                                    <i class="bi bi-geo-alt"></i>
                                    <span>@(suKien.DiaDiem?.TenDiaDiem ?? "Chưa có địa điểm")</span>
                                </div>
                                <div class="event-card-time">
                                    <i class="bi bi-clock"></i>
                                    <span>@suKien.GioToChuc.ToString("HH:mm")</span>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <p class="text-muted text-center">Hiện chưa có sự kiện nào của nghệ sĩ này.</p>
            }
        </div>
    </div>
</div>

<script>
    function followArtist(artistId, artistName) {
        const isAuthenticated = @User.Identity.IsAuthenticated.ToString().ToLower();

        if (!isAuthenticated) {
            alert('Bạn cần đăng nhập để thực hiện chức năng này!');
            window.location.href = '/Identity/Account/Login';
        } else {
            alert('Đã theo dõi ' + artistName + '! Bạn sẽ nhận thông báo khi có sự kiện mới.');
            // Future: API call to save follow relationship
        }
    }
</script>
